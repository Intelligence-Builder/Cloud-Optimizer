# Default values for cloud-optimizer.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 2

image:
  # Docker image repository
  # For ECR: <aws_account_id>.dkr.ecr.<region>.amazonaws.com/cloud-optimizer
  # For Docker Hub: cloudoptimizer/cloud-optimizer
  # For public ECR: public.ecr.aws/<alias>/cloud-optimizer
  repository: cloud-optimizer
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  # Common tags: latest, v1.0.0, main-<sha>, develop-<sha>
  tag: ""

# Image pull secrets for private registries
# For ECR, create a secret with ECR credentials:
#   kubectl create secret docker-registry ecr-registry-secret \
#     --docker-server=<aws_account_id>.dkr.ecr.<region>.amazonaws.com \
#     --docker-username=AWS \
#     --docker-password=$(aws ecr get-login-password --region <region>)
# Note: For EKS with IAM roles, this may not be needed if using IRSA
imagePullSecrets: []
# Example:
# imagePullSecrets:
#   - name: ecr-registry-secret
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

service:
  type: ClusterIP
  port: 8000

ingress:
  enabled: true
  className: "alb"
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS": 443}]'
    alb.ingress.kubernetes.io/ssl-redirect: '443'
    alb.ingress.kubernetes.io/healthcheck-path: /health
    alb.ingress.kubernetes.io/healthcheck-interval-seconds: '15'
    alb.ingress.kubernetes.io/healthcheck-timeout-seconds: '5'
    alb.ingress.kubernetes.io/healthy-threshold-count: '2'
    alb.ingress.kubernetes.io/unhealthy-threshold-count: '2'
  hosts:
    - host: cloud-optimizer.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: cloud-optimizer-tls
  #    hosts:
  #      - cloud-optimizer.example.com

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# Liveness probe configuration
livenessProbe:
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# Readiness probe configuration
readinessProbe:
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity: {}

# Pod Disruption Budget configuration
podDisruptionBudget:
  enabled: false
  # Minimum number of pods that must be available
  minAvailable: 1
  # Maximum number of pods that can be unavailable
  # Use either minAvailable OR maxUnavailable, not both
  # maxUnavailable: 1

# Database configuration
database:
  host: "postgres-service"
  port: 5432
  name: "cloud_optimizer"
  user: "cloud_optimizer"

# Secret references - DO NOT put actual credentials here
# Create these secrets separately using kubectl or a secret management tool
secrets:
  # Database password secret name
  databasePasswordSecret: "cloud-optimizer-db-credentials"
  # JWT secret key secret name
  jwtSecretKey: "cloud-optimizer-jwt"
  # Intelligence Builder credentials secret name
  ibCredentials: "cloud-optimizer-ib-credentials"
  # AWS credentials secret name
  awsCredentials: "cloud-optimizer-aws-credentials"

# ECR Configuration (if using Amazon ECR)
# These values are used to configure ECR image pull secrets and registry settings
ecr:
  # Enable ECR-specific configurations
  enabled: false
  # AWS Account ID (e.g., 123456789012)
  accountId: ""
  # AWS Region (e.g., us-east-1)
  region: "us-east-1"
  # Repository name (should match the ECR repository)
  repositoryName: "cloud-optimizer"
  # Automatically create image pull secret using IRSA (requires EKS with IRSA configured)
  # If true, the service account will be annotated with the IAM role
  useIRSA: true
  # IAM role ARN for IRSA (only needed if useIRSA is true)
  iamRoleArn: ""

# Application configuration (non-sensitive)
config:
  # API configuration
  apiHost: "0.0.0.0"
  apiPort: "8000"

  # JWT configuration
  jwtAlgorithm: "HS256"
  jwtAccessTokenExpireMinutes: "15"

  # Intelligence Builder configuration
  ibPlatformUrl: "https://ib-platform.example.com"
  ibTenantId: ""

  # AWS configuration
  awsDefaultRegion: "us-east-1"

  # Feature flags
  enableSecurityDomain: "true"
  enableCostDomain: "true"
  enablePerformanceDomain: "true"
  enableReliabilityDomain: "true"
  enableOperationsDomain: "true"

  # Logging
  logLevel: "INFO"
  debug: "false"
