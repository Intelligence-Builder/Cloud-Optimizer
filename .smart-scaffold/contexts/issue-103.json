{
  "issue_number": 103,
  "title": "8.1.3 Build NLU service with LLM-based intent classification",
  "body": "## Parent Issue\n#35 - 8.1 NLU Pipeline\n\n## Objective\nImplement the main NLU service that processes user messages through LLM-based intent classification.\n\n## Implementation\n\n```python\n# src/ib_platform/nlu/service.py\nfrom anthropic import Anthropic\nimport asyncio\n\nclass NLUService:\n    def __init__(self, anthropic_client: Anthropic):\n        self.client = anthropic_client\n\n    async def process(\n        self, \n        message: str, \n        conversation_history: list[dict]\n    ) -> NLUResult:\n        \"\"\"Process user message through NLU pipeline.\"\"\"\n        # Run intent classification and entity extraction in parallel\n        intent_task = asyncio.create_task(self._classify_intent(message))\n        entities_task = asyncio.create_task(self._extract_entities(message))\n\n        intent, confidence = await intent_task\n        entities = await entities_task\n\n        # Build context from conversation history\n        context = self._build_context(conversation_history, entities)\n\n        return NLUResult(\n            intent=intent,\n            confidence=confidence,\n            entities=entities,\n            context=context,\n            requires_findings=self._requires_findings(intent),\n            requires_documents=self._requires_documents(intent, conversation_history),\n        )\n\n    async def _classify_intent(self, message: str) -> tuple[Intent, float]:\n        \"\"\"Classify message intent using Claude Haiku.\"\"\"\n        prompt = f'''Classify the following user message...'''\n        \n        response = await self.client.messages.create(\n            model=\"claude-3-haiku-20240307\",\n            max_tokens=100,\n            messages=[{\"role\": \"user\", \"content\": prompt}],\n        )\n        # Parse JSON response and return intent, confidence\n```\n\n## Files to Create\n- `src/ib_platform/nlu/service.py`\n- `tests/ib_platform/nlu/test_nlu_service.py`\n\n## Acceptance Criteria\n- [ ] NLU service accepts message and history\n- [ ] Intent classified using Claude Haiku\n- [ ] Entity extraction runs in parallel\n- [ ] NLUResult returned with all fields\n- [ ] >90% accuracy on test cases\n- [ ] Integration tests with mocked LLM\n\n## Estimated Time\n3 hours",
  "labels": [
    "mvp",
    "phase-2",
    "ib",
    "ai",
    "nlu"
  ],
  "assignees": [],
  "milestone": null,
  "created_at": null,
  "updated_at": null,
  "state": "OPEN",
  "context": {
    "complexity": "medium",
    "effort": "medium",
    "confidence": 0.8,
    "required_expertise": [],
    "dependencies": [],
    "related_files": []
  },
  "generated_at": "2025-12-04T11:47:50.801893Z",
  "generated_by": "smart-scaffold-cli",
  "branch_name": "feature/issue-103-813buildnluservicewithllm-base"
}